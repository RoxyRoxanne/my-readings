	<url:file:///~/Dropbox (Personal)/mynotes/content/code/cosx/internet_connection_drops_constantly.md>

# Wifi Ok But Internet Constantly Dropping

I have MacBook Pro (Retina, 13-inch, Early 2015) with OsX 10.11.5. 

The computer connects to wifi but internet connection drops constantly. 

All other devices (phones and macbooks) have internet connection without any issue.

I have no problems connecting to other networks with my macbook pro.

When the internet connection drops, I turn off and on the wifi. Then the computer connects to internet for a while. But after a few minutes the connection drops again. Sometimes it gets fixed without any intervention. There is no regular pattern in connection droppings.

I read the following posts in stackexchange that describe similar connectivity issues: http://apple.stackexchange.com/questions/177873/full-wi-fi-ethernet-signal-but-no-internet http://apple.stackexchange.com/questions/26616/dns-not-resolving-on-mac-os-x

I tried the followings a lot of times to no avail:

1. Renewing/turning off&on/inputting manually DHCP.
2. Restarting/resetting the router and the macbook.
3. Turning WiFi on/off. This fixes the problem for a few minutes but then the connection drops again.
4. Set all network configurations except wifi to "make service unavailable" in network preferences.
5. Checked and copied all network settings from another macbook pro that's connected and online on my network.
6. Ran network diagnostic and assistant tools
7. Set Network > Wifi > Advanced > DNS > DNS servers to OpenDNS ip addresses: 208.67.222.222
8. No Proxies is checked or set under Network > Wifi > Advanced > Proxies.
9. Set TCP/IP > Configure IPv6 to "Link-local only" as suggested here: http://apple.stackexchange.com/a/248228/21401
10. Logging in and connecting to internet with guest user account.

I didn't try the followings:

1. Duplicated/removed/added location
2. Removed the /Library/Preferences/SystemConfiguration folder.
3. Removed network password from keychain.
4. Resetting SMC 

I tried the following commands on terminal:

	$ ifconfig en1
	en1: flags=963<UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX> mtu 1500
					options=60<TSO4,TSO6>
					ether 4a:00:03:bd:de:d0
					media: autoselect <full-duplex>
					status: inactive
	$ ifconfig awdl0
	awdl0: flags=8943<UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST> mtu 1484
					ether 76:aa:18:a6:c9:49
					inet6 fe80::74aa:18ff:fea6:c949%awdl0 prefixlen 64 scopeid 0x8
					nd6 options=1<PERFORMNUD>
					media: autoselect
					status: active
	$ sudo ifconfig awdl0 down

I did the last command because it was suggested here: http://apple.stackexchange.com/a/235742/21401

My modem router has no black/whitelist for any MAC addresses.

Osx Firewall is off.

There is an interesting observation. skype client usually becomes online even I cannot connect to internet through web browsers, pinging, and Dropbox/spotify like client applications.

When internet connection drops, I cannot ping to OpenDNS host:

	$ ping 208.67.222.222
	PING 208.67.222.222 (208.67.222.222): 56 data bytes
	Request timeout for icmp_seq 0
	Request timeout for icmp_seq 1

nslookup and dig don't return result neither:

	$ nslookup apple.com
	;; connection timed out; no servers could be reached
	; <<>> DiG 9.8.3-P1 <<>> apple.com
	;; global options: +cmd
	;; connection timed out; no servers could be reached

flushing DNS cache didn't help neither:

	$ sudo dscacheutil -flushcache
	$ sudo killall -HUP mDNSResponder

Here is DNS server settings:

	$ cat /etc/resolv.conf
	#
	# Mac OS X Notice
	#
	# This file is not used by the host name and address resolution
	# or the DNS query routing mechanisms used by most processes on
	# this Mac OS X system.
	#
	# This file is automatically generated.
	#
	nameserver 208.67.222.222
	nameserver 208.67.220.220

I tried restarting mDNSResponder as suggested here to no avail: http://apple.stackexchange.com/a/48828/21401

	sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist
	sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist

https://www.dropbox.com/s/sxcpcwp1lek7cr2/sysdiagnose_2016.11.20_11-11-55%2B0300_89823.tar.gz?dl=1

https://www.dropbox.com/s/ot3b6pkrfpq0k70/WirelessDiagnostics_C02QKQAQFVH5_2016-11-20_11.03.41.tar.gz?dl=1
